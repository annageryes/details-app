pipeline{
    agent {label 'workers'} // needs to have ssh agent
    parameters{
        string(name: 'sleep_time', defaultValue:'2', description:'time to sleep')
    }
    stages{
       
        
        stage('Build'){
            steps{
                echo 'Building the Project'
                sleep "${sleep_time}"
                sh '''
                    sudo docker build -t details-app:latest .
                '''
            } // error with builds clean up 
        }
        
        

        stage('Docker image Save'){
            steps{
                echo 'Testing'
                sleep "${sleep_time}"
                sh"""
                    sudo docker login -u ${UNAME} -p ${PASSWD} 
                    sudo docker tag ${docker_image_name}:${docker_image_version} ${registry_user}/${docker_image_name}:${docker_image_version} 
                    sudo docker push ${registry_user}/${docker_image_name}:${docker_image_version} 
                """ 
            }
        }
    }
    post {
        success{
            sh""""
                docker save ${registry_user}/${docker_image_name}:${docker_image_version}  -o "${docker_image_name}:${docker_image_version}.tgz"
            """
            archiveArtifacts artifacts: 'details_app_docker.latest.tgz', followSymlinks: false, onlyIfSuccessful: true      
        }
    }
}
     

    
